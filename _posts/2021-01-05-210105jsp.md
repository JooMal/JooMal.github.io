---
layout: post
title: "인프런 - 실전 JSP 6"
date: 2021-01-05
tags: [jsp, backend]
category : [study]
comments: true
---

# 𝗝𝗦𝗣

- [수강 코스](https://www.inflearn.com/course/%EC%8B%A4%EC%A0%84-jsp_renew/lecture/13652)

# 𝓓𝓪𝔂 6

## 18. JDBC
JAVA와 오라클이 통신할 수 있게 해주는 API이다. eclipse에서도 오라클 API를 이용하기 위해서, Oracle LIB을 이클립스에 복사하여 사용한다.  

### 18.1. JDBC 설정
1) 이클립스 Preferences - class path에서 jre path를 확인한다.  
2) `C:\oraclexe\app\oracle\product\11.2.0\server\jdbc\lib`에 있는 `ojbc6.jar` 파일을 복사해서 위의 jre lib ext path에 넣는다.  

### 18.2. JDBC를 이용한 데이터 관리
#### 전체적인 흐름
client <-> jsp,servlet <-> DB  
클라이언트가 jsp, servlet에 요청을 하면, 웹서버는 JDBC를 이용하여 DB에 접근한다.  
#### JDBC 실행 순서
1) Driver loading : `class.forName(driver);`라고 드라이버 이름을 명시해주어서, Oracle Driver를 메모리에 로딩하여 언제든지 쓸 수 있게 된다.  
2) Connection : 자바와 오라클을 연결해주기 위해, 연결을 해주는 connection 객체를 얻는다. `con = DriverManager.getConnection(url, id, pw);` 를 이용하여 커넥션 객체를 받는다.  
3) Statement : `stmt = con.createStatement();` 를 이용하여 자바에서도 쿼리문을 날릴 수 있는 객체인 `statement`를 커넥션으로부터 구한다.  
4) query : `String sql = "SELECT * FROM book";` 이런 식으로 String type query문을 작성해준다.  
5) run : 작성한 쿼리문을 statme 객체에 넣어주어 쿼리를 전송한다. `res = stmt.executeQuery(sql);`  

```java
response.setContentType("text/html; charset=UTF-8");
PrintWriter out = response.getWriter();

String bookName = request.getParameter("book_name");
String bookLoc = request.getParameter("book_loc");

String driver = "oracle.jdbc.driver.OracleDriver";
String url = "jdbc:oracle:thin:@localhost:1521:xe";
String id = "scott";
String pw = "tiger";

Connection con = null;
Statement stmt = null;

try {
  Class.forName(driver);

  con = DriverManager.getConnection(url, id, pw);
  stmt = con.createStatement();
  String sql = "INSERT INTO book(book_id, book_name, book_loc)";
      sql += " VALUES (BOOK_SEQ.NEXTVAL, '" + bookName + "', '" + bookLoc + "')";

  // executeUpdate()는 쿼리가 적용된 갯수를 반환한다.
  // 에러가 발생해서 아무것도 적용이 안되었다면, 0을 return한다.
  int result = stmt.executeUpdate(sql);

  if(result == 1) {
    out.print("INSERT success!!");
  } else {
    out.print("INSERT fail!!");
  }

// 데이터베이스와 관련된건 네트워크상의 문제 등이
// 있을 수 있으므로 꼭 try-catch 문으로 묶어주어야 한다.
} catch (Exception e) {
  e.printStackTrace();
} finally {
  try {
    //리소스를 썼으면 해제해주는 작업도 해주어야 한다. 이에 stmt가 null이면 리소스를 close해주는 작업을 해주고 있다.
    if(stmt != null) stmt.close();
    if(con != null) con.close();
  } catch (Exception e2) {
    e2.printStackTrace();
  }
}
}
```

statement문에서는 SELECT할 때에는 stmt.executeQuery(), 나머지는 stmt.executeUpdate()를 해준다.  

### 18.3. PreparedStatement
statement에서 쿼리문을 조작할 때, 코드가 지저분한 감이 있다. 이를 보완하기 위해서 PreparedStatement를 사용합니다.    
이전에 JDBC에선 Statement를 먼저 작성하고, 그 다음에 query문을 작성했다. pstmt의 경우에는 query를 먼저 작성하되, 사용자가 입력할 값은 `?`로 남겨둡니다. 이를 통해 쿼리문이 상당히 보기 편해집니다.  
이후 connection에서 prepareStatmenet에 sql 쿼리를 넘겨줍니다.  

```java
String sql = "UPDATE book SET book_loc = ? WHERE book_name =?";
pstmt = con.prepareStatement(sql);
pstmt.setString(1, "001-00007123");
pstmt.setString(2, "book7");
```

위처럼 쿼리문의 질의에 들어갈 위치에 값을 넣어주며, Human Error를 줄일 수 있습니다.  

## 19. DAO와 DTO

### 19.1. DAO, DTO란?
웹서버는 브라우저에게 요청을 받고, 이후 DB에 접근하여 여러 작업을 시행하는데요.  
- DAO는 Data Access Object로, DB에 접근하는 기능을 수행하는 오브젝트입니다. 이전에는 Servlet, DAO를 같은 파일에 섞어서 작성했는데요. 객체로 DAO 파트를 떼어내어 사용하게 됩니다.   
- DTO는 Data Transfer Object입니다. DB에 있는 데이터의 형태와, 자바에서 관리하는 데이터의 형태가 다릅니다. DB의 데이터 형태가 컬럼별로 정리가 되어있는데, 자바에서는 이를 가져와서 자바만의 다양한 자료형으로 변환하여 사용하게 됩니다. 이 데이터타입의 차이를 변환해주는 것이 DTO입니다. (다른 말로 DTO는 VO라고도 부릅니다.)  

### 19.2. DAO, DTO 구현
