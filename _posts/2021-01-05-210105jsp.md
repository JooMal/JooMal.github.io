---
layout: post
title: "ì¸í”„ëŸ° - ì‹¤ì „ JSP 6"
date: 2021-01-05
tags: [jsp, backend]
category : [study]
comments: true
---

# ğ—ğ—¦ğ—£

- [ìˆ˜ê°• ì½”ìŠ¤](https://www.inflearn.com/course/%EC%8B%A4%EC%A0%84-jsp_renew/lecture/13652)

# ğ““ğ“ªğ”‚ 6

## 18. JDBC
JAVAì™€ ì˜¤ë¼í´ì´ í†µì‹ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” APIì´ë‹¤. eclipseì—ì„œë„ ì˜¤ë¼í´ APIë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œ, Oracle LIBì„ ì´í´ë¦½ìŠ¤ì— ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•œë‹¤.  

### 18.1. JDBC ì„¤ì •
1) ì´í´ë¦½ìŠ¤ Preferences - class pathì—ì„œ jre pathë¥¼ í™•ì¸í•œë‹¤.  
2) `C:\oraclexe\app\oracle\product\11.2.0\server\jdbc\lib`ì— ìˆëŠ” `ojbc6.jar` íŒŒì¼ì„ ë³µì‚¬í•´ì„œ ìœ„ì˜ jre lib ext pathì— ë„£ëŠ”ë‹¤.  

### 18.2. JDBCë¥¼ ì´ìš©í•œ ë°ì´í„° ê´€ë¦¬
#### ì „ì²´ì ì¸ íë¦„
client <-> jsp,servlet <-> DB  
í´ë¼ì´ì–¸íŠ¸ê°€ jsp, servletì— ìš”ì²­ì„ í•˜ë©´, ì›¹ì„œë²„ëŠ” JDBCë¥¼ ì´ìš©í•˜ì—¬ DBì— ì ‘ê·¼í•œë‹¤.  
#### JDBC ì‹¤í–‰ ìˆœì„œ
1) Driver loading : `class.forName(driver);`ë¼ê³  ë“œë¼ì´ë²„ ì´ë¦„ì„ ëª…ì‹œí•´ì£¼ì–´ì„œ, Oracle Driverë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë”©í•˜ì—¬ ì–¸ì œë“ ì§€ ì“¸ ìˆ˜ ìˆê²Œ ëœë‹¤.  
2) Connection : ìë°”ì™€ ì˜¤ë¼í´ì„ ì—°ê²°í•´ì£¼ê¸° ìœ„í•´, ì—°ê²°ì„ í•´ì£¼ëŠ” connection ê°ì²´ë¥¼ ì–»ëŠ”ë‹¤. `con = DriverManager.getConnection(url, id, pw);` ë¥¼ ì´ìš©í•˜ì—¬ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ë°›ëŠ”ë‹¤.  
3) Statement : `stmt = con.createStatement();` ë¥¼ ì´ìš©í•˜ì—¬ ìë°”ì—ì„œë„ ì¿¼ë¦¬ë¬¸ì„ ë‚ ë¦´ ìˆ˜ ìˆëŠ” ê°ì²´ì¸ `statement`ë¥¼ ì»¤ë„¥ì…˜ìœ¼ë¡œë¶€í„° êµ¬í•œë‹¤.  
4) query : `String sql = "SELECT * FROM book";` ì´ëŸ° ì‹ìœ¼ë¡œ String type queryë¬¸ì„ ì‘ì„±í•´ì¤€ë‹¤.  
5) run : ì‘ì„±í•œ ì¿¼ë¦¬ë¬¸ì„ statme ê°ì²´ì— ë„£ì–´ì£¼ì–´ ì¿¼ë¦¬ë¥¼ ì „ì†¡í•œë‹¤. `res = stmt.executeQuery(sql);`  

```java
response.setContentType("text/html; charset=UTF-8");
PrintWriter out = response.getWriter();

String bookName = request.getParameter("book_name");
String bookLoc = request.getParameter("book_loc");

String driver = "oracle.jdbc.driver.OracleDriver";
String url = "jdbc:oracle:thin:@localhost:1521:xe";
String id = "scott";
String pw = "tiger";

Connection con = null;
Statement stmt = null;

try {
  Class.forName(driver);

  con = DriverManager.getConnection(url, id, pw);
  stmt = con.createStatement();
  String sql = "INSERT INTO book(book_id, book_name, book_loc)";
      sql += " VALUES (BOOK_SEQ.NEXTVAL, '" + bookName + "', '" + bookLoc + "')";

  // executeUpdate()ëŠ” ì¿¼ë¦¬ê°€ ì ìš©ëœ ê°¯ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤.
  // ì—ëŸ¬ê°€ ë°œìƒí•´ì„œ ì•„ë¬´ê²ƒë„ ì ìš©ì´ ì•ˆë˜ì—ˆë‹¤ë©´, 0ì„ returní•œë‹¤.
  int result = stmt.executeUpdate(sql);

  if(result == 1) {
    out.print("INSERT success!!");
  } else {
    out.print("INSERT fail!!");
  }

// ë°ì´í„°ë² ì´ìŠ¤ì™€ ê´€ë ¨ëœê±´ ë„¤íŠ¸ì›Œí¬ìƒì˜ ë¬¸ì œ ë“±ì´
// ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê¼­ try-catch ë¬¸ìœ¼ë¡œ ë¬¶ì–´ì£¼ì–´ì•¼ í•œë‹¤.
} catch (Exception e) {
  e.printStackTrace();
} finally {
  try {
    //ë¦¬ì†ŒìŠ¤ë¥¼ ì¼ìœ¼ë©´ í•´ì œí•´ì£¼ëŠ” ì‘ì—…ë„ í•´ì£¼ì–´ì•¼ í•œë‹¤. ì´ì— stmtê°€ nullì´ë©´ ë¦¬ì†ŒìŠ¤ë¥¼ closeí•´ì£¼ëŠ” ì‘ì—…ì„ í•´ì£¼ê³  ìˆë‹¤.
    if(stmt != null) stmt.close();
    if(con != null) con.close();
  } catch (Exception e2) {
    e2.printStackTrace();
  }
}
}
```

statementë¬¸ì—ì„œëŠ” SELECTí•  ë•Œì—ëŠ” stmt.executeQuery(), ë‚˜ë¨¸ì§€ëŠ” stmt.executeUpdate()ë¥¼ í•´ì¤€ë‹¤.  

### 18.3. PreparedStatement
statementì—ì„œ ì¿¼ë¦¬ë¬¸ì„ ì¡°ì‘í•  ë•Œ, ì½”ë“œê°€ ì§€ì €ë¶„í•œ ê°ì´ ìˆë‹¤. ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ì„œ PreparedStatementë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.    
ì´ì „ì— JDBCì—ì„  Statementë¥¼ ë¨¼ì € ì‘ì„±í•˜ê³ , ê·¸ ë‹¤ìŒì— queryë¬¸ì„ ì‘ì„±í–ˆë‹¤. pstmtì˜ ê²½ìš°ì—ëŠ” queryë¥¼ ë¨¼ì € ì‘ì„±í•˜ë˜, ì‚¬ìš©ìê°€ ì…ë ¥í•  ê°’ì€ `?`ë¡œ ë‚¨ê²¨ë‘¡ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì¿¼ë¦¬ë¬¸ì´ ìƒë‹¹íˆ ë³´ê¸° í¸í•´ì§‘ë‹ˆë‹¤.  
ì´í›„ connectionì—ì„œ prepareStatmenetì— sql ì¿¼ë¦¬ë¥¼ ë„˜ê²¨ì¤ë‹ˆë‹¤.  

```java
String sql = "UPDATE book SET book_loc = ? WHERE book_name =?";
pstmt = con.prepareStatement(sql);
pstmt.setString(1, "001-00007123");
pstmt.setString(2, "book7");
```

ìœ„ì²˜ëŸ¼ ì¿¼ë¦¬ë¬¸ì˜ ì§ˆì˜ì— ë“¤ì–´ê°ˆ ìœ„ì¹˜ì— ê°’ì„ ë„£ì–´ì£¼ë©°, Human Errorë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

## 19. DAOì™€ DTO

### 19.1. DAO, DTOë€?
ì›¹ì„œë²„ëŠ” ë¸Œë¼ìš°ì €ì—ê²Œ ìš”ì²­ì„ ë°›ê³ , ì´í›„ DBì— ì ‘ê·¼í•˜ì—¬ ì—¬ëŸ¬ ì‘ì—…ì„ ì‹œí–‰í•˜ëŠ”ë°ìš”.  
- DAOëŠ” Data Access Objectë¡œ, DBì— ì ‘ê·¼í•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤. ì´ì „ì—ëŠ” Servlet, DAOë¥¼ ê°™ì€ íŒŒì¼ì— ì„ì–´ì„œ ì‘ì„±í–ˆëŠ”ë°ìš”. ê°ì²´ë¡œ DAO íŒŒíŠ¸ë¥¼ ë–¼ì–´ë‚´ì–´ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.   
- DTOëŠ” Data Transfer Objectì…ë‹ˆë‹¤. DBì— ìˆëŠ” ë°ì´í„°ì˜ í˜•íƒœì™€, ìë°”ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë°ì´í„°ì˜ í˜•íƒœê°€ ë‹¤ë¦…ë‹ˆë‹¤. DBì˜ ë°ì´í„° í˜•íƒœê°€ ì»¬ëŸ¼ë³„ë¡œ ì •ë¦¬ê°€ ë˜ì–´ìˆëŠ”ë°, ìë°”ì—ì„œëŠ” ì´ë¥¼ ê°€ì ¸ì™€ì„œ ìë°”ë§Œì˜ ë‹¤ì–‘í•œ ìë£Œí˜•ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ ë°ì´í„°íƒ€ì…ì˜ ì°¨ì´ë¥¼ ë³€í™˜í•´ì£¼ëŠ” ê²ƒì´ DTOì…ë‹ˆë‹¤. (ë‹¤ë¥¸ ë§ë¡œ DTOëŠ” VOë¼ê³ ë„ ë¶€ë¦…ë‹ˆë‹¤.)  

### 19.2. DAO, DTO êµ¬í˜„
