---
layout: post
title: "2022.06.17"
date: 2022-06-17
tags: [TIL]
category : [TIL]
comments: true
---

### 로그의 중요성

실무에서는 로그 관리에 굉장히 많은 노력을 쏟는다. 배포 후에 발생하는 장애를 바로 체크하기 위해, 그리고 사용자들에게는 보여주지 않는 에러를 
실무 개발자들이 확인 후 조치하기 위해서 사용한다.  

### 로깅

로그 파일을 남기기 위해서 Logback 을 사용하곤 하는데, 우선 `@Slf4j` 어노테이션으로 클래스에 다짜고짜 붙이는 건 기본 logger를 받아오고, 
그 logger에 세팅된 설정으로만 동작하기 때문에 적절하게 Logger 를 나누어 만들어주는 것도 중요한 듯 싶다.  

https://cofs.tistory.com/354 를 참고해보면, RollingFileAppender 라는 클래스에 대한 설명이 간략하게 나와있다. 이는 로그 파일이 
꽉 차면 규칙에 따라 다음 로그 파일을 생성해주는 클래스인데, 지나가버린 로그를 지워버릴 수는 없는 노릇이기에 이 클래스에 파일 이름 규칙 등을 넣는 식으로 
많이 사용한다. (파일 트리를 보면 나오는 spring-logback.xml 참고, 없는 경우 검색해서 보자.)  

추가로 로깅에 있어서 사수에게 들었던 조언도 기억난다. log.debug("xxx") 으로 냅다 남겨버리는 게 아니라,
1. `if(log.isDebugEnabled()) { 로 그 남 기 기 } ` 처럼 해당 로그 레벨이 enable 되어있는 지를 체크 후 로그를 남겨준다. 이유는 로그 level 이 현재 enable 되어있지 않더라도, JVM 입장에서는 해당 로그를 찍는 데에 이미 에너지를 쏟는다. (에너지를 쏟는게 아니라... 뭐더라... 급 단어가 기억이 안남. 부하를 사용한다? 연산을 낭비한다?) 그래서 Enable 여부를 체크하고 로깅해주는 게 너무너무 중요함. (특히 TB에서는 debug 단계까지 다 찍는데, 상용에서 debug까지 다 찍으면 부하로 인해 연산이 느려지기 때문에 debug는 skip하고 warn 처럼 강력하고 무서운 놈들만 찍어준다.)
2. `log.warn("메세지", e)` 이렇게 끝에 exception 을 남겨주어 도통 무슨 익셉션이 잡힌 건지를 남겨주어야 어디에서 장애가 발생한건지 원인을 파악할 수 있다. 그러니까 꼭 맨 끝에 e 를 붙여서 넣어주기!

위와 같은 실무 팁을 얻었던 희미한 기억이 난다.

얼마전에는 직접 logback 파일을 만져보기도 했는데, 그 이유는... 현재 개발하는 프로젝트가 일종의 전사용 베이직한 템플릿 프로젝트인데, 프레임워크처럼 기본적인 기능은 다 갖춘 상태에서 커스텀하는 부분은 비즈니스 로직 개발자가 구현체로 받아와서 만들게 되어 있다. 
그런데, 로깅된 놈을 특정 규격으로 바꾸어서 출력하는 LogConverter 를 구현해두어야 할 필요가 있었다. 예시용 겸, 실제로 사내에서 가장 많이 사용하는 로깅 규격을 넣어두어야 했기 때문임. 이 때문에 logger를 분리하고, 그 logger를 타면 아예 별도 파일 이름으로 로그 파일이 생성되게 해야 했음.  
이에 따라서 logback spring xml 에서 그 로거에 대한 RollingFileAppender 설정을 넣어주고, 특정 로그 파일에서만 해당 규격의 로그가 쭉쭉 찍히게 넣어주어야 했기 때문에 사용해봄.  

또 급 생각난거는 이번에 로깅 기능을 구현한 게 굉장히 재미있었는데... 그건 바로 Spring Filter를 첨으로 사용해보았기 때문임. Filter와 Interceptor 의 가장 큰 차이는?  
바로바로 Filter는 스프링의 관리 밖, servlet 에서 제공하는 기능이고 Interceptor는 스프링의 관리 안에 있기 때문임. 그렇다면 왜 Filter를 썼는가? 스프링 동작에서, url 이 들어오면 그 url 을 갖는 컨트롤러로 매핑해준다. 근데 내가 만들어야 했던 로깅 기능은 컨트롤러로 매핑이 되지 않더라도  
우선 e2e 로 요청이 들어오면 내가 그 놈을 잡아다가 로그 정보를 만들기 시작해야 하고, 어떤 컨트롤러로 매핑이 되었는 지도 넣어주어야 해서 Filter를 사용했다.  


흠... 글고 Masking 어노테이션을 만드는 개발도 했는데, 이놈도 굉장히 흥미로웠지만 추후 서술하도록 하겠다. 암튼 요즘은 이런 저런 신규기능을 개발하고 있다. 이렇게 연차가 병아리인 내가 과연 기능을 개발해도 되는가? 싶긴 한데... 뭐 어쩔건지? 장애나지 않게 주의는 하되 장애가 나더라도 수습하면서 좋은 경험이 될테니 어떻게든 되지 않을까?
